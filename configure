#!/bin/sh
PREFIX=/usr/local
SHARED_LDFLAGS="-shared -ldl"
SHARED="yes"
STATIC="yes"
ALL_T="\$(LUA_T) \$(LUAC_T)"

usage () {
	cat <<- EOF
	Usage: $0 [OPTION]... [VAR=VALUE]...

	Installation directories:
	  --prefix=PREFIX         main installation prefix [/usr/local]
	
	Other Options:
	  --without-shared        skip compiling shared libraries
	  --without-static        skip compiling static libraries

	EOF
	exit 0
}


for arg; do
	case $arg in
		--prefix=*) PREFIX=${arg#*=};;
		--without-shared) SHARED=no;;
		--without-static) STATIC=no;;
		--*=*) ;;
		--help|*) usage;;
	esac
done

OS=$(uname)
case "$OS" in
	Linux)    SHARED_LDFLAGS="-shared -ldl";;
	Darwin)  SHARED_LDFLAGS="-bundle -undefined dynamic_lookup";;
	*)     echo "$0: unsuppoted OS" 1>&2;;
esac

if [ $SHARED = "yes" ]; then
	ALL_T="$ALL_T \$(CORE_SO) "
	LIBDEPS="$LIBDEPS \$(CORE_SO) "
fi

if [ $STATIC = "yes" ]; then
	ALL_T="$ALL_T \$(CORE_T) "
	LIBDEPS="$LIBDEPS \$(CORE_T) "
fi

exec 3>&1 1>config.mk
echo ALL_T=$ALL_T
echo LIBDEPS=$LIBDEPS
echo PREFIX=$PREFIX
echo SHARED_LDFLAGS=$SHARED_LDFLAGS
exec 1>&3 3>&-

echo done 1>&2
